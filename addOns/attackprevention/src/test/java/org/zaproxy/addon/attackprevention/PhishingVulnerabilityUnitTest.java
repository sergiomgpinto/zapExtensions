package org.zaproxy.addon.attackprevention;

import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.zaproxy.addon.attackprevention.database.PhishingHistory;
import org.zaproxy.addon.attackprevention.database.PhishingHistoryTesting;
import org.zaproxy.addon.attackprevention.vulnerability.PhishingVulnerability;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotEquals;

class PhishingVulnerabilityUnitTest {

    @BeforeEach
    void setUp() {

        PhishingHistory phishingHistory = new PhishingHistory();

        phishingHistory.addVisitedSite("username" ,
                "password"
                , "www.google-123-unittest.com");
    }

    /**
     * This method tests the case of a phishing attack
     */
    @Test
    void phishingAttackCaseTest() {
        PhishingVulnerability attack = new PhishingVulnerability("username",
                "password",
                "www.google.com");

        assertEquals("Phishing attack detected", attack.evaluateVulnerability());
    }
    /**
     * This method tests the case where there is no phishing attack
     */
    @Test
    void NophishingAttackCaseTest() {
        PhishingVulnerability attack = new PhishingVulnerability("username",
                "password",
                "www.google-123-unittest.com");

        assertNotEquals("Phishing attack detected", attack.evaluateVulnerability());
    }

    @AfterEach
    void cleanUp() {
        PhishingHistoryTesting phishingHistory = new PhishingHistoryTesting();
        phishingHistory.removeVisitedSite("username" ,
                "password",
                "www.google-123-unittest.com");
    }

    @AfterAll
    static void cleanUpAll() {
        PhishingHistoryTesting phishingHistory = new PhishingHistoryTesting();
        phishingHistory.cleanVisitedSiteandLegitimateSite();
    }
}
